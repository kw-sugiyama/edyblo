<?
/******************************************************************************
	<< ÉÔÆ°»º¥Ö¥í¥° Ver.1.0.0 >>
	Name: img_list.php
	Version: 1.0.0
	Function: ¥¤¥á¡¼¥¸BOX
	Author: Click inc
	Date of creation: 2010/05
	History of modification:

	Copyright (C)2007 Click, inc. All Rights Reserverd.
******************************************************************************/

// ºÇÂçÅÐÏ¿²ÄÇ½·ï¿ô¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢
define(_LIMIT , 500);

$syserr_msg = "img_list.php¤Ç¥·¥¹¥Æ¥à¥¨¥é¡¼¤¬È¯À¸¤·¤Þ¤·¤¿¡£´ÉÍý¼Ô¤ËÏ¢Íí¤·¤Æ²¼¤µ¤¤¡ª";
$syserr_msg1 = "¥í¥°¥¤¥ó¾ðÊó¤¬¤¢¤ê¤Þ¤»¤ó¡£";
require_once ( "../ini_sets_2.php" );
require_once ( SYS_PATH."dbif/dbcom_DBconnectClass.php" );
require_once ( SYS_PATH."dbif/basedb_ClientClass.php" );
require_once ( SYS_PATH."dbif/basedb_sql_class.php" );
require_once ( SYS_PATH."common/base_common.php" );
require_once ( SYS_PATH."common/sys_common.php" );
include_once ( SYS_PATH."common/error.class.php" );
require_once ( SYS_PATH."configs/param_base.conf" );
require_once ( SYS_PATH."configs/param_file.conf" );
require_once ( SYS_PATH."configs/param_image_extension.conf" );

/*----------------------------------------------------------
  ¥»¥Ã¥·¥ç¥óÅÐÏ¿³«»Ï
----------------------------------------------------------*/
session_start();
/*----------------------------------------------------------
        ¥¨¥é¡¼¥¯¥é¥¹ - ¥¤¥ó¥¹¥¿¥ó¥¹
----------------------------------------------------------*/
$obj_error = new DispErrMessage();
/*----------------------------------------------------------
  DBÀÜÂ³
----------------------------------------------------------*/
require_once( SYS_PATH."common/db_connect.php" );
/*----------------------------------------------------------
  ¥í¥°¥¤¥ó¾ðÊó¥Á¥§¥Ã¥¯
----------------------------------------------------------*/
require_once("../login_chk.php");
/*--------------------------------------------------------
	½èÍýÉôÊ¬
--------------------------------------------------------*/
// ²èÁü¥Ç¥£¥ì¥¯¥È¥êºîÀ®
define(_IMG_DIR, $param_img_list_path . $_SESSION["_cl_id"] . "/");
define(_IMG_DIR_ADMIN, $param_img_list_path_admin . $_SESSION["_cl_id"] . "/");
if ( !is_dir(_IMG_DIR_ADMIN)  ) {
	mkdir(_IMG_DIR_ADMIN);
	chmod(_IMG_DIR_ADMIN, 0777);
}


/*--------------------------------------------------------
	POSTÃÍ¤ò³ÊÇ¼¤¹¤ëhidden¤òºîÀ®
--------------------------------------------------------*/
$athComment = "";
FOREACH( $_POST as $key => $val ){
	$val = stripslashes(htmlspecialchars($val));
	$athComment .= "<input type=\"hidden\" name=\"{$key}\" value=\"{$val}\">\n";
	
	if (
		$key == "search_title"
		or $key == "search_sort"
	) {
		$search_hidden .= "<input type=\"hidden\" name=\"{$key}\" value=\"{$val}\">\n";
	}
}

// Â¿½ÅÅê¹ÆËÉ»ß
$ttoken = $_POST['tt'];
$sesToken = $_SESSION['tt'];

if( $_POST["mode"] == "ins" ){
	// ²èÁüÄÉ²Ã¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢
	
	// ¥­¡¼¤¬°ìÃ×¤·¤¿¤é¹¹¿·²Ä
	if($ttoken === $sesToken){
		unset( $_SESSION['tt'] );

		$strErrorComment = "¥Õ¥¡¥¤¥ë¤¬ÉÔÀµ¤Ç¤¹¡£<br />UP¤·¤¿¥Õ¥¡¥¤¥ë¤ò³ÎÇ§¤·¤Æ²¼¤µ¤¤¡£";
		IF( is_uploaded_file( $_FILES['img_name']['tmp_name'] ) ){
		
			// ¥Õ¥¡¥¤¥ë¥µ¥¤¥º 2M¤Þ¤Ç
			if( filesize($_FILES['img_name']['tmp_name']) > (1024*1024*2) ) {
				// ²èÁü¤¬ÉÔÀµ
				$arrOther["ath_comment"] .= $athComment;
				$obj_error->ViewErrMessage( "FILE_SIZE" , "ALL" , "img_list.php" , $arrOther );
				exit;
			}
			
			$image_ret = @getimagesize( $_FILES['img_name']['tmp_name'] );
			// gif or jpg ¤Ï²èÁü¤ÈÈ½ÃÇ
			if ( $image_ret[2] == IMAGETYPE_GIF or $image_ret[2] == IMAGETYPE_JPEG ) {
				// ³ÈÄ¥»Ò
				$ext = $param_image_extension[ $image_ret[2] ];
			} else {
				//¤½¤ì°Ê³°¤Ï¸µ¥Õ¥¡¥¤¥ëÌ¾¤«¤é³ÈÄ¥»Ò¤ò¼èÆÀ
				$ext = end(explode('.', $_FILES['img_name']['name']));
			}
			
			// insert
			$obj_ins = new basedb_sql_class;
			$obj_ins->set_conn ( $obj_conn->conn );
			$obj_ins->set_table ( "base_t_img_list" );
			$obj_ins->set_serial ( "img_id" );
			$arr_data = array();
			$arr_data["img_cl_id"]		= $_SESSION["_cl_id"];
			$arr_data["img_title"]		= $_POST["img_title"];
			$arr_data["img_url"]		= $_POST["img_url"];
			$arr_data["img_link_type"]	= $_POST["img_link_type"];
//			$arr_data["img_org_name"]	= basename( $_FILES['img_name']['name']); // basename php5¤Ç¤Ï¥Þ¥ë¥Á¥Ð¥¤¥È¤¬Íè¤¿»þ¤Ë¥Ð¥°¤¬¤¢¤ë php6¤Ç²ò¾ÃÍ½Äê 2013/05/01 Wed ÂçÄÍ 2013/05/09 °Ü¿¢ ¹âÌÚ
			$arr_data["img_org_name"]	= end(split('/', $_FILES['img_name']['name']));

			$arr_data["img_ins_date"]	= "now";
			$arr_data["img_upd_date"]	= "now";
			$obj_ins->set_data ($arr_data);
//			$obj_ins->set_debug ( true );
			$ret = $obj_ins->db_insert();
			
			// insert¤·¤¿¹Ô¤Îid
			$ins_id = $obj_ins->data[$obj_ins->serial];
			
			// id¤ò»ý¤Ã¤Æ¤µ¤é¤Ëupdate
			$obj_upd = new basedb_sql_class;
			$obj_upd->set_conn ( $obj_conn->conn );
			$obj_upd->set_table ( "base_t_img_list" );
			$obj_upd->set_tbl_rows ( 1 );
			$arr_data = array();
			$arr_data["img_id"] = $ins_id;
			$obj_upd->set_tbl_key ( $arr_data );

			// ¥Õ¥¡¥¤¥ëÌ¾
			$files_name = $ins_id.'.'.$ext;
			// ¸µ²èÁü¥Õ¥¡¥¤¥ëÌ¾
			//$files_name_org =  $_FILES['img_name']["name"];
			
			$arr_data = array();
//			$arr_data["img_name"]		= pg_escape_string( $files_name );
			$arr_data["img_name"]		= $files_name;
			$arr_data["img_ext"]		= $ext;
			$arr_data["img_upd_date"]	= "now";
			$obj_upd->set_data ( $arr_data );
//			$obj_upd->set_debug ( true );
			$ret = $obj_upd->db_update();

			if( $ret == "0" )
			{
				//½èÍýÂ³¹Ô
				if (is_uploaded_file($_FILES['img_name']['tmp_name']) && $files_name )
				{
					// ²èÁü¥Õ¥¡¥¤¥ë¤òÊÝÂ¸
					move_uploaded_file($_FILES['img_name']['tmp_name'], _IMG_DIR . $files_name);
					chmod(_IMG_DIR . $files_name, 0777);
				}
			}
		}else{
			//½èÍýÃæÃÇ
		}

		IF( $ret != 0 ){
			// ÅÐÏ¿½èÍýÃæ¤Ë¥¨¥é¡¼
			$arrOther["ath_comment"] .= $athComment;
			$obj_error->ViewErrMessage( "INS_ERROR" , "ALL" , "img_list.php" , $arrOther );
			exit;
		}

	}
}else if ( $_POST["mode"] == "del" ){
	
	// ²èÁüºï½ü¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢¢£¢¢
	// ¥­¡¼¤¬°ìÃ×¤·¤¿¤é¹¹¿·²Ä
	if($ttoken === $sesToken){
		unset( $_SESSION['tt'] );

		$obj_del = new basedb_sql_class;
		$obj_del->set_conn ( $obj_conn->conn );
		$obj_del->set_table ( "base_t_img_list" );
		$obj_del->set_tbl_rows ( 1 );
		$arr_data = array();
//		$arr_data["img_id"] = pg_escape_string($_POST["del_img_id"]);
		$arr_data["img_id"] = $_POST["del_img_id"];
		$obj_del->set_tbl_key ( $arr_data );
//		$obj_del->set_debug ( true );
		$ret = $obj_del->db_delete();

		if( $ret != "0" )
		{
			// ºï½ü½èÍýÃæ¤Ë¥¨¥é¡¼
			$arrOther["ath_comment"] .= $athComment;
			$obj_error->ViewErrMessage( "DEL_ERROR" , "ALL" , "img_list.php" , $arrOther );
			exit;
		}

		// ²èÁü¥Õ¥¡¥¤¥ë¤òºï½ü
		if ( file_exists(_IMG_DIR . $_POST["del_img_name"]) ) {
			unlink(_IMG_DIR . $_POST["del_img_name"]);
		}
	}
}

// Â¿½ÅÅê¹ÆËÉ»ß ¤¢¤ëÄøÅÙ°ì°Õ¤ÊÊ¸»úÎó¤òÀ¸À®¤¹¤ë
$_SESSION['tt'] = uniqid('transactiontoken');

// ¥¤¥á¡¼¥¸BOX¾ðÊó
$obj_img = new basedb_sql_class;
$obj_img->set_conn ( $obj_conn->conn );
$obj_img->set_table ( "base_t_img_list" );
$arr_data = array();
$arr_data["img_cl_id"][0] = "=";
$arr_data["img_cl_id"][1] = $_SESSION["_cl_id"];

if ( isset($_POST["search_title"]) and $_POST["search_title"] != "" ) {
	$arr_data["img_title"][0] = "like";
//	$arr_data["img_title"][1] = pg_escape_string($_POST["search_title"]);
	$arr_data["img_title"][1] = $_POST["search_title"];
	$search_title = htmlspecialchars($_POST["search_title"]);
}

$obj_img->set_jyoken ($arr_data);

$arr_data = array();
if ( isset($_POST["search_sort"]) and $_POST["search_sort"] == 9 ) {
	// search_sort:9 Ì¾Á°½ç
	$arr_data["img_title"] = "asc";
	$search_sort_checked_9 = "checked";
} else {
	// search_sort:1 ÅÐÏ¿½ç
	$arr_data["img_upd_date"] = "desc";
	$search_sort_checked_1 = "checked";
}

$obj_img->set_sort ($arr_data);
//$obj_img->set_debug ( true );

list( $imglistcnt , $imglistTotal ) = $obj_img->db_select( _LIMIT, 0 );

$disp_data = "";
for( $ix = 0; $ix < $imglistcnt; $ix++ ) {
	$img_id			= htmlspecialchars($obj_img->data[$ix]["img_id"]);
	$img_title		= htmlspecialchars($obj_img->data[$ix]["img_title"]);
	$img_url		= htmlspecialchars($obj_img->data[$ix]["img_url"]);
	$img_link_type	= htmlspecialchars($obj_img->data[$ix]["img_link_type"]);
	$img_name		= htmlspecialchars($obj_img->data[$ix]["img_name"]);
	$img_org_name	= htmlspecialchars($obj_img->data[$ix]["img_org_name"]);
	$ext			= htmlspecialchars($obj_img->data[$ix]["img_ext"]);
	
	// http¥Ñ¥¹ÀßÄê
	if($login_val["cl_googlemap_key"]!="" && $login_val["cl_dokuji_flg"]=="1" && $login_val["cl_dokuji_domain"]!=""){
		$http_path = $login_val["cl_dokuji_domain"] . $param_img_list_path_http;
	}else{
		$http_path = $param_base_blog_addr_url . $param_base_blog_addr . $login_val["cl_url_code"] . "/" . $param_img_list_path_http;
	}
	
	//²èÁü¤Î¾ì¹ç¤Î½èÍý
	if($ext == 'gif' || $ext == 'jpg' || false){
		// ²èÁü¥µ¥¤¥º¼èÆÀ
		$img_arr = @getimagesize( _IMG_DIR . $obj_img->data[$ix]["img_name"] );
		// Å½¤êÉÕ¤±ÍÑ¥¿¥°¤òÀ¸À®
		$img_tag		= '<img src="' . $http_path . $_SESSION["_cl_id"] . "/" . $obj_img->data[$ix]["img_name"]
					. '" alt="' . $obj_img->data[$ix]["img_title"]
					. '" title="' . $obj_img->data[$ix]["img_title"]
					. '" width="' . $img_arr[0]
					. '" height="' . $img_arr[1]
					. '"/>';
		
		// ¥ê¥ó¥¯ÀèURL¤¬ÆþÎÏ¤µ¤ì¤Æ¤¤¤¿¾ì¹ç¡¢a¥¿¥°¤Ç°Ï¤à
		if ( $img_url != "" ) {
			if ( $img_link_type == 1 ) {
				// ¥ê¥ó¥¯¥¿¥¤¥× 1:self
				$target = '_self';
			} else {
				// ¥ê¥ó¥¯¥¿¥¤¥× 9:blank
				$target = '_blank';
			}
			$input_val = '<a href="' . $obj_img->data[$ix]["img_url"] . '" target="' . $target . '">' . $img_tag . '</a>';
		} else {
			$input_val = $img_tag;
		}
		$input_val = htmlspecialchars($input_val);
		
		$disp_data .= "        <li class=\"li_img\">\n";
		$disp_data .= "          <a href=\"" . _IMG_DIR . "{$img_name}\" class=\"highslide\" onclick=\"return hs.expand(this)\" onkeypress=\"return hs.expand(this)\" >\n";
		$disp_data .= "            <img src=\"./img_thumbnail.php?w=150&h=150&dir=" . _IMG_DIR . "&nm={$img_name}\" alt=\"{$img_title}\" title=\"{$img_title}\" />\n";
		$disp_data .= "          </a>\n";
		
		// ¥Ý¥Ã¥×¥¢¥Ã¥×ÆâÉô
		$disp_data .= "          <div class=\"highslide-caption\">\n";
		$disp_data .= "            <form name=\"img_form_{$ix}\" action=\"img_list.php\" method=\"POST\" >\n";
		$disp_data .= "              {$img_title}<br />\n";
		$disp_data .= "              <input type=\"text\" name=\"tag\" value=\"{$input_val}\" onFocus=\"this.select();\" style=\"width:100%;\" />\n";
		$disp_data .= "              <input type=\"button\" name=\"img_del\" value=\"ºï½ü\" onClick=\"fn_del_img(this.form);\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"mode\" value=\"del\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"del_img_id\" value=\"{$img_id}\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"del_img_name\" value=\"{$img_name}\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"tt\" value=\"{$_SESSION['tt']}\" />\n";
		$disp_data .= $search_hidden;
		$disp_data .= "            </form>\n";
		
		$disp_data .= "          </div>\n";
		
		$disp_data .= "        </li>\n";
		
	//¤½¤ì°Ê³°¤Î¾ì¹ç¤Î½èÍý
	}else{
		
		// Å½¤êÉÕ¤±ÍÑ¥¿¥°¤òÀ¸À®
		// a¥¿¥°¤Ç°Ï¤à
		if ( $img_link_type == 1 ) {
			// ¥ê¥ó¥¯¥¿¥¤¥× 1:self
			$target = '_self';
		} else {
			// ¥ê¥ó¥¯¥¿¥¤¥× 9:blank
			$target = '_blank';
		}
		$input_val = '<a href="' . $http_path . $_SESSION["_cl_id"] . '/' . $img_name . '" target="' . $target . '">' . $img_title . '</a>';
		$input_val = htmlspecialchars($input_val);
		
		$disp_data .= "        <li class=\"li_img\">\n";
		$disp_data .= "          <a href=\"./file_img.gif\" class=\"highslide\" onclick=\"return hs.expand(this)\" onkeypress=\"return hs.expand(this)\" >\n";
		$disp_data .= "            <img src=\"./img_thumbnail.php?w=150&h=150&dir=./&nm=file_img.gif\" alt=\"{$img_title}\" title=\"{$img_title}\" />\n";
		$disp_data .= "          </a>\n";
		
		// ¥Ý¥Ã¥×¥¢¥Ã¥×ÆâÉô
		$disp_data .= "          <div class=\"highslide-caption\">\n";
		$disp_data .= "            <form name=\"img_form_{$ix}\" action=\"img_list.php\" method=\"POST\" >\n";
		$disp_data .= "              {$img_title}<br />\n";
		$disp_data .= "              <input type=\"text\" name=\"tag\" value=\"{$input_val}\" onFocus=\"this.select();\" style=\"width:100%;\" />\n";
		$disp_data .= "              <input type=\"button\" name=\"img_del\" value=\"ºï½ü\" onClick=\"fn_del_img(this.form);\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"mode\" value=\"del\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"del_img_id\" value=\"{$img_id}\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"del_img_name\" value=\"{$img_name}\" />\n";
		$disp_data .= "              <input type=\"hidden\" name=\"tt\" value=\"{$_SESSION['tt']}\" />\n";
		$disp_data .= $search_hidden;
		$disp_data .= "            </form>\n";
		
		$disp_data .= "          </div>\n";
		
		$disp_data .= "        </li>\n";
		
	}
}
if ( $imglistcnt <= 0 ) {
	$disp_data .= "        <li>¥Õ¥¡¥¤¥ë¤ÎÅÐÏ¿¤¬¤¢¤ê¤Þ¤»¤ó¡£</li>\n";
}

// ·ï¿ôÀ©¸Â¤Î°Ù¤Ë¤â¤¦°ì²ó¼èÆÀ
$obj_total_img = new basedb_sql_class;
$obj_total_img->set_conn ( $obj_conn->conn );
$obj_total_img->set_table ( "base_t_img_list" );
$arr_data = array();
$arr_data["img_cl_id"][0] = "=";
$arr_data["img_cl_id"][1] = $_SESSION["_cl_id"];
$obj_total_img->set_jyoken ($arr_data);

//$obj_total_img->set_debug ( true );

list( $allcnt , $allcnt_total ) = $obj_total_img->db_select( _LIMIT, 0 );

if ( $allcnt >= _LIMIT ) {
	// ºÇÂç·ï¿ô¤ËÃ£¤·¤Æ¤ë¤è·Ù¹ð
	$js_str = "return fn_limit_alert();";
} else {
	// ÅÐÏ¿¥Á¥§¥Ã¥¯
	$js_str = "return fn_check(this.form);";
}


/*----------------------------------------------------------
  DBÀÚÃÇ
----------------------------------------------------------*/
require_once( SYS_PATH."common/db_close.php" );
/*--------------------------------------------------------
	HTMLÀ¸À®
--------------------------------------------------------*/
?>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=EUC-JP" />
    <title>ÉÔÆ°»º¥Ö¥í¥° - ¥¯¥é¥¤¥¢¥ó¥È´ÉÍý¥Ä¡¼¥ë</title>
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <link rel="stylesheet" type="text/css" href="../share/css/img_list.css" />
    <script type="text/javascript" src="../share/js/input_check.js"></script>
    <script type="text/javascript" src="../share/js/img_list.js"></script>
    <link rel="stylesheet" type="text/css" href="../share/highslide/highslide.css" />
    <script type="text/javascript" src="../share/highslide/highslide.js"></script>
    <script type="text/javascript" src="../share/highslide/highslide_config.js"></script>
    <noscript><meta http-equiv="Refresh" content="1;URL=../jserror.html"></noscript>
 </head>
  <body>
<div style="text-align:right">
<?=$Msg?>
</div>
    <span class="title">¥Õ¥¡¥¤¥ëBOX</span>
    <p>¥Õ¥¡¥¤¥ë¤ò¥¢¥Ã¥×¥í¡¼¥É¤¹¤ë¤È¡¢²èÁü¡Êgif ¤Þ¤¿¤Ï jpg¡Ë¤Î¾ì¹ç&lt;img&gt;¥¿¥°¡¢¤½¤ì°Ê³°¤Î¾ì¹ç¤Ï¡¢&lt;a&gt;¥¿¥°¤¬È¯¹Ô¤µ¤ì¤Þ¤¹¡£</p>
    <p>È¯¹Ô¤µ¤ì¤¿¥¿¥°¤Ïhtml¼«Í³É½µ­ÉôÊ¬Åù¤Ë»ÈÍÑ¤¹¤ë¤³¤È¤¬½ÐÍè¤Þ¤¹¡£</p>
    <p>²èÁü¤Î¾ì¹ç¡¢¥ê¥ó¥¯ÀèURL¤òÆþÎÏ¤¹¤ë¤È¡¢&lt;a&gt;¥¿¥°ÉÕ¤­¤ÇÈ¯¹Ô¤µ¤ì¤Þ¤¹¡£</p>
    <hr color="#96BC69" />
    <span class="sub_title">ÅÐÏ¿</span> <span class="alert"><?=$allcnt?> / <?php print _LIMIT; ?> ·ï</span>
    <table id="table_ins">
      <form name="ins_form" action="img_list.php" method="POST" enctype="multipart/form-data">
      <tr>
        <td class="td_title">¥Õ¥¡¥¤¥ë¥¿¥¤¥È¥ë</td>
        <td class="td_val01"><input type="text" name="img_title" value="" maxlength="50" style="width:200px;" /></td>
        <td class="td_title">¥Õ¥¡¥¤¥ë</td>
        <td class="td_val02"><input type="file" name="img_name"></td>
        <td class="td_val03" align="center" rowspan="2">
          <input type="submit" value="ÅÐÏ¿" onclick="<?=$js_str?>" class="btn" />
        </td>
      </tr>
      <tr>
        <td class="td_title">¥ê¥ó¥¯ÀèURL<br /><span style="font-size:smaller">¡Ê²èÁü¤Î¤ßÍ­¸ú¡Ë</span></td>
        <td class="td_val01"><input type="text" name="img_url" value="" maxlength="500" style="width:200px;" /></td>
        <td class="td_title">¥ê¥ó¥¯¥¿¥¤¥×</td>
        <td class="td_val02">
          <input type="radio" name="img_link_type" id="img_link_type_1" value="1" checked /><label for="img_link_type_1">Æ±¤¸¥¦¥¤¥ó¥É¥¦¤Ç³«¤¯</label>
          <br /><input type="radio" name="img_link_type" id="img_link_type_9" value="9" /><label for="img_link_type_9">ÊÌ¤Î¥¦¥¤¥ó¥É¥¦¤Ç³«¤¯</label>
        </td>
      </tr>
      <input type="hidden" name="mode" value="ins" />
      <input type="hidden" name="tt" value="<?=$_SESSION['tt']?>" />
<?=$search_hidden?>
      </form>
    </table>
    
    <hr color="#96BC69" />

    <span class="sub_title">¸¡º÷</span>
    <table id="table_search">
      <tr>
        <form name="serach_form" action="img_list.php" method="POST" enctype="multipart/form-data">
          <td class="td_title">¥¿¥¤¥È¥ë</td>
          <td class="td_search01">
            <input type="text" name="search_title" maxlength="50" style="width:200px;" value="<?=$search_title?>" />
          </td>
          <td class="td_title">É½¼¨½ç</td>
          <td class="td_search02">
            <input type="radio" name="search_sort" value="1" id="search_sort_1" <?=$search_sort_checked_1?> /><label for="search_sort_1">¢¦ÅÐÏ¿½ç</label>
            <br /><input type="radio" name="search_sort" value="9" id="search_sort_9" <?=$search_sort_checked_9?> /><label for="search_sort_9">¢¤Ì¾Á°½ç</label>
          </td>
          <td class="td_search03" align="center" >
            <input type="submit" value="¸¡º÷" class="btn" id="search_btn" style="display:inline;" />
            <br /><input type="button" value="²ò½ü" onclick="location.href='img_list.php'" class="btn" id="search_btn" />
          </td>
        </form>
      </tr>
    </table>
    <hr color="#96BC69" />

    <ul>
<?=$disp_data?>
    </ul>


    <hr color="#96BC69" />
<br />
  </body>
</html>



